<html>
  <head>
    
    <meta content='FAQ: Pitfalls of Next-Token Prediction - Vaishnavh Nagarajan' property='og:title' />
    <title>FAQ: Pitfalls of Next-Token Prediction - Vaishnavh Nagarajan</title>
    <!--
<script type='text/javascript'>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  //]]>
</script>
-->



<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TZ1W6KRGW0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TZ1W6KRGW0');
</script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">





<link href='https://fonts.googleapis.com/css?family=IM Fell DW Pica|IM Fell DW Pica SC|IM Fell English|IM Fell English SC|IM Fell French Canon|IM Fell Great Primer|IM Fell Great Primer SC|IM Fell Great Primer IT|IM Fell Double Pica|Libre Caslon Text|Jost|Instrument Serif' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=IM+Fell+Great+Primer:400,400i&display=swap' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Instrument+Serif:400,400i&display=swap' rel='stylesheet'>


<!--<link href='http://fonts.googleapis.com/css?family=Teko|Dosis:400,800|Economica|Josefin+Sans|Oswald|Indie+Flower|Pacifico|Roboto' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css' /> -->
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/syntax.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/responsive.css' rel='stylesheet' type='text/css' />
<!-- - -->
<script src='/javascripts/jquery.js' type='text/javascript'></script>
<script src='/javascripts/pd.js' type='text/javascript'></script>
<script src='/javascripts/basics.js' type='text/javascript'></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<!-- - -->
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />
<meta content="http://muan.co/images/og.png" property="og:image" />
<meta content="" property="fb:app_id" />

  <meta content='http://localhost:4000' property='og:url' />
  <meta content="Welcome to my personal website!" property='og:description' />
  <meta content="blog" property="og:type" />

<!-- - -->



<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=604714799556697";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>




  </head>
  <body>
    <header>
<!--<br><p>Vaishnavh Nagarajan</p>-->
</header>
    <div id='container'>
      <div class="content">
                    <nav>

  <div class="navigation">
    <div class="logo"><a href="/home/index.html">Vaishnavh Nagarajan</a></div>
    <div class="menu">

  
    <a href="/home/index.html"  class="link">
      <div class="title">
      About
    </div>
    </a>
  
    <a href="/home/index.html#research"  class="link">
      <div class="title">
      Research
    </div>
    </a>
  
    <a href="/talks/index.html"  class="link">
      <div class="title">
      Talks
    </div>
    </a>
  
    <a href="/blog/index.html"  class="link">
      <div class="title">
      Blog
    </div>
    </a>
  
    </div>
    <button id="theme-toggle-button" class="font-awesome-icons">
        <i id="theme-toggle-icon" class="fas fa-moon"></i>  <span class="visually-hidden">Toggle Dark Mode</span>
      </button>
  </div>
</nav>
        <section class='blog-post'>
          <br><br>
          <div class="blogtitle">FAQ: Pitfalls of Next-Token Prediction</div>


        <div class="blogbody"><p>Below, I address some of the often asked questions about our findings in this paper<sup id="fnref:pitfalls" role="doc-noteref"><a href="#fn:pitfalls" class="footnote" rel="footnote">1</a></sup></p>

<p><strong>Q. I gave this problem to my favorite language model and it easily solved it.</strong></p>

<p>A. Our result is not meant to be interpreted that way. Imagine there is a skill we want in the future but this is not covered in our current generation models; imagine that your solution is to collect many demonstrations of said skill and teach it to the model using next-token training. Are you guaranteed that the model will learn it this way? This is what we give some insight into.</p>

<p><strong>Q. Next-token training may not solve this task. But wouldn’t reinforcement learning or chain-of-thought come to the rescue?</strong></p>

<p>A. Totally! But it is worth considering  the following:</p>

<ul>
  <li>
    <p>Is there any headroom during pretraining? Would a different objective save us a lot of compute/data?</p>
  </li>
  <li>
    <p>Would reinforcement learning teach us <em>all</em> skills including ones that don’t already exist within the model? What about situations (like creativity) where rewards are very sparse?</p>
  </li>
  <li>
    <p>Are there tasks that are not chain-of-thought-friendly? How about tasks that require a “spark”?</p>
  </li>
</ul>

<p><strong>Q. The failure you show here is for a very specific graph structure. This doesn’t look like it will generalize to natural language. Is this failure any relevant to practice?</strong></p>

<p>A. You’re right that the <em>striking</em> failure requires the paths to be non-branching to encourage learning Clever Hans cheats; this is not true of language, where you expect a branching structure. Let’s step back and get a broader view of things:</p>

<ul>
  <li>
    <p>Language pretraining is not the only situation where next-token-learning is used for. There are many applications such as protein modeling where models are trained with next-token prediction.  See for instance, this paper<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup> which reports how models learn shortcuts when trying to imitate human behavior.</p>
  </li>
  <li>
    <p>Eliminating “striking failure” is a binary target; it isn’t the practitioners only business; they also need to care about data- and compute-efficiency. It is possible that, even if the model can recover from such cheats, the gradients corresponding to those cheats are wasteful. If you see Fig 6, you’ll see that the next-token predicting model is inefficient.</p>
  </li>
</ul>

<p><strong>Q. It’s not just the topology of the task that makes it special, but it’s also that your path lengths are all fixed. What happens if I mix the data with graphs of varying complexities?</strong></p>

<p>A. In that case, we expect the model to solve the problem! See Figure 2 in this excellent paper<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup> where they show how Transformers can remarkably solve compositional tasks with really small depth; if you notice, the model is trained on a dataset of varying hops, unlike in our path-star task (which is also a compositional task, but with a fixed hop).</p>

<p>To teach compositional tasks, models need some form of stepwise supervision. Your suggestion, in line with the above paper, is to use <em>curriculum</em>. Another alternative is to give <em>chain-of-thought supervision</em> (see this paper<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>). These are great and practically important insights; the path-star’s insight is independent of this. It is that you may be squandering away supervision that already exists in your data simply because your supervision is sub-optimal.</p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:pitfalls" role="doc-endnote">
      <p><a href="https://arxiv.org/abs/2403.06963">The pitfalls of next-token prediction</a> <a href="#fnref:pitfalls" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p><a href="https://osf.io/preprints/psyarxiv/u7z4t_v1">Centaur May Have Learned a Shortcut that Explains Away Psychological Tasks</a> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p><a href="https://arxiv.org/abs/2402.09268">Transformers, parallel computation, and logarithmic depth</a> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p><a href="https://arxiv.org/abs/2309.06979">Auto-Regressive Next-Token Predictors are Universal Learners</a> <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
        </section>
      </div>

        <div class="post-navigation">
  

  
</div>

          <!-- <div class="block">
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
<a class="a2a_button_x"></a>
<a class="a2a_button_google_gmail"></a>
<a class="a2a_button_threads"></a>
<a class="a2a_button_hacker_news"></a>
<a class="a2a_button_linkedin"></a>
<a class="a2a_button_reddit"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_mastodon"></a>
</div>
<script async src="https://static.addtoany.com/menu/page.js"></script>
</div> -->
      <!--  <div class="block">
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/faq/ntp/';
      this.page.identifier = 'http://localhost:4000/faq/ntp/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://vaishnavh.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div> 
 -->

 

<div class="block">
  <div id="disqus_thread"></div>
  <script>
    // The original Disqus embed script. We now rely on the global disqus_config
    // defined above, and the reset logic in the theme toggler.
    // Ensure this script still runs to initially load Disqus.
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://vaishnavh.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

    </div>




    <footer>

  <br />
  <script type="text/javascript" language="javascript">
  <!--
  // Email obfuscator script 2.1 by Tim Williams, University of Arizona
  // Random encryption key feature by Andrew Moulden, Site Engineering Ltd
  // This code is freeware provided these four comment lines remain intact
  // A wizard to generate this code is at http://www.jottings.com/obfuscator/
  //-->
  </script><noscript>first name AT google DOT com</noscript>



					<br />
					<br />
  Built with Jekyll using Scribble.
  <br>
  <img src="/images/scribble2.png " alt="scribble" /> 
</footer>
    <script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const themeToggleIcon = document.getElementById('theme-toggle-icon');  // New: select the icon
    const body = document.body;
    const currentTheme = localStorage.getItem('theme');

    console.log('DOMContentLoaded fired');
    console.log('themeToggleButton:', themeToggleButton);
    console.log('body:', body);
    console.log('currentTheme:', currentTheme);

    // Define disqus_config globally or within a scope accessible by DISQUS.reset
    // A more robust way is to make it a named function or a property of window
    // so DISQUS.reset can find it.
   // so DISQUS.reset can find it.
    window.disqus_config = function () {
      this.page.url = 'http://localhost:4000/faq/ntp/';
      this.page.identifier = 'http://localhost:4000/faq/ntp/';

      // Get the current theme from your body's data-theme attribute
      var disqusTheme = localStorage.getItem('theme');

      // Set the Disqus theme based on your site's current theme
      if (currentThemeForDisqus === 'light') {
        this.page.display_thread_theme = 'light';
      } else {
        this.page.display_thread_theme = 'dark';
      }
    };

    
    const initializeTheme = () => {
      const themeToggleButton = document.getElementById('theme-toggle-button');
      const themeToggleIcon = document.getElementById('theme-toggle-icon');  // New: select the icon
      if (!themeToggleButton) {
        console.error('Dark mode toggle element not found!');
        return;
      }

      console.log('initializeTheme called, themeToggleButton:', themeToggleButton);

      // Set initial theme based on local storage
      if (currentTheme === 'light') {
        body.setAttribute('data-theme', 'light');
        themeToggleIcon.classList.remove('fa-sun');   // Switch to sun icon
        themeToggleIcon.classList.add('fa-moon');
        console.log('Setting light theme initially');
      } else {
        body.setAttribute('data-theme', 'dark');  // Default to dark
        themeToggleIcon.classList.remove('fa-moon');   // Switch to moon icon
        themeToggleIcon.classList.add('fa-sun');
        console.log('Setting default dark theme');
      }

      // Add event listener for toggle change
      themeToggleButton.addEventListener('click', function() {
        console.log('Toggle clicked');
        if (body.getAttribute('data-theme') === 'dark') {
          body.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
          themeToggleIcon.classList.remove('fa-sun');   // Switch to sun icon
          themeToggleIcon.classList.add('fa-moon');
        } else {
          body.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
          themeToggleIcon.classList.remove('fa-moon');   // Switch to moon icon
          themeToggleIcon.classList.add('fa-sun');
        }
        console.log('body.getAttribute("data-theme"):', body.getAttribute('data-theme'));

        // --- NEW: Reset Disqus theme after the site theme changes ---
        if (typeof DISQUS !== 'undefined') { // Check if Disqus is loaded
          DISQUS.reset({
            reload: true, // This tells Disqus to reload the embed
            config: function () {
              // Re-run the configuration to apply the new theme
              // This relies on window.disqus_config being accessible
              window.disqus_config.call(this);
            }
          });
          console.log('Disqus reset initiated with new theme.');
        }
        // --- END NEW ---
      });
    };

    if (document.readyState === 'loading') {
      document.addEventListener('readystatechange', function() {
        if (document.readyState === 'interactive' || document.readyState === 'complete') {
          initializeTheme();
        }
      });
      console.log('readyState is loading, adding readystatechange listener');
    } else {
      initializeTheme();
      console.log('readyState is not loading, calling initializeTheme directly');
    }
  });
</script>
<script src="/assets/js/footnotes.js"></script>
  </body>
</html>
